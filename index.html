<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Lobby with Multiple Game Modes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: Arial, sans-serif;
            color: #fff;
        }
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10;
            flex-direction: column;
        }
        #lobby {
            display: none;
        }
        .button {
            margin: 10px;
            padding: 10px 20px;
            background: #0f9;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .button:hover {
            background: #0c6;
        }
        input {
            margin: 5px;
            padding: 10px;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div id="auth">
            <h1>Welcome</h1>
            <button id="loginButton" class="button">Login</button>
            <button id="signupButton" class="button">Sign Up</button>
        </div>

        <div id="signup" style="display: none;">
            <h2>Sign Up</h2>
            <input id="newUsername" type="text" placeholder="Username">
            <input id="newPassword" type="password" placeholder="Password">
            <button id="createAccountButton" class="button">Create Account</button>
        </div>

        <div id="login" style="display: none;">
            <h2>Login</h2>
            <input id="loginUsername" type="text" placeholder="Username">
            <input id="loginPassword" type="password" placeholder="Password">
            <button id="loginSubmitButton" class="button">Login</button>
        </div>

        <div id="lobby">
            <button id="queueButton" class="button">Queue in Battle Royale</button>
            <button id="infectedButton" class="button">Play Infected</button>
            <button id="ctfButton" class="button">Play Capture the Flag</button>
            <button id="addFriendButton" class="button">Add Friend</button>
            <input id="friendUsername" type="text" placeholder="Friend's Username">
            <div id="party" style="margin-top: 20px;"></div>
        </div>

        <div id="gameOptions" style="display: none;">
            <h2>Choose Game Mode Options</h2>
            <select id="teamMode">
                <option value="solo">Solo</option>
                <option value="duo">Duo</option>
                <option value="trio">Trio</option>
                <option value="squad">Squads</option>
            </select>
            <select id="difficulty">
                <option value="easy">Easy</option>
                <option value="medium">Medium</option>
                <option value="hard">Hard</option>
            </select>
            <button id="startGameButton" class="button">Start Game</button>
        </div>
    </div>

    <script>
        const users = {}; // Store users in memory
        let currentUser = null;

        // UI Elements
        const authDiv = document.getElementById('auth');
        const signupDiv = document.getElementById('signup');
        const loginDiv = document.getElementById('login');
        const lobbyDiv = document.getElementById('lobby');
        const gameOptionsDiv = document.getElementById('gameOptions');

        const loginButton = document.getElementById('loginButton');
        const signupButton = document.getElementById('signupButton');
        const createAccountButton = document.getElementById('createAccountButton');
        const loginSubmitButton = document.getElementById('loginSubmitButton');
        const queueButton = document.getElementById('queueButton');
        const infectedButton = document.getElementById('infectedButton');
        const ctfButton = document.getElementById('ctfButton');
        const startGameButton = document.getElementById('startGameButton');

        const addFriendButton = document.getElementById('addFriendButton');
        const friendUsernameInput = document.getElementById('friendUsername');
        const partyDiv = document.getElementById('party');

        // Phaser Game Config
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const game = new Phaser.Game(config);

        function preload() {
            this.load.image('battleBus', 'assets/battleBus.png'); // Load Battle Bus image
        }

        function create() {
            this.add.image(400, 300, 'battleBus').setOrigin(0.5, 0.5); // Add Battle Bus at center
            this.text = this.add.text(400, 550, 'Battle Bus is Loading...', {
                font: '24px Arial',
                fill: '#fff'
            }).setOrigin(0.5);
        }

        function update() {
            // Add any animations or actions during the game update
        }

        // Authentication Handlers
        signupButton.addEventListener('click', () => {
            authDiv.style.display = 'none';
            signupDiv.style.display = 'block';
        });

        loginButton.addEventListener('click', () => {
            authDiv.style.display = 'none';
            loginDiv.style.display = 'block';
        });

        createAccountButton.addEventListener('click', () => {
            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newPassword').value;

            if (username && password) {
                if (!users[username]) {
                    users[username] = password;
                    alert('Account created successfully!');
                    signupDiv.style.display = 'none';
                    authDiv.style.display = 'block';
                } else {
                    alert('Username already exists!');
                }
            } else {
                alert('Please fill in all fields!');
            }
        });

        loginSubmitButton.addEventListener('click', () => {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (users[username] && users[username] === password) {
                currentUser = username;
                alert(`Welcome, ${username}!`);
                loginDiv.style.display = 'none';
                lobbyDiv.style.display = 'block';
            } else {
                alert('Invalid username or password!');
            }
        });

        // Lobby Handlers
        queueButton.addEventListener('click', () => {
            showGameOptions('Battle Royale');
        });

        infectedButton.addEventListener('click', () => {
            showGameOptions('Infected');
        });

        ctfButton.addEventListener('click', () => {
            showGameOptions('Capture the Flag');
        });

        function showGameOptions(mode) {
            lobbyDiv.style.display = 'none';
            gameOptionsDiv.style.display = 'block';
            startGameButton.onclick = () => {
                const teamMode = document.getElementById('teamMode').value;
                const difficulty = document.getElementById('difficulty').value;
                startGame(mode, teamMode, difficulty);
            };
        }

        function startGame(mode, teamMode, difficulty) {
            alert(`Starting ${mode} in ${teamMode} mode on ${difficulty} difficulty.`);
            gameOptionsDiv.style.display = 'none';
            game.scene.start('BattleBus'); // Start Battle Bus scene
        }

        addFriendButton.addEventListener('click', () => {
            const friendUsername = friendUsernameInput.value;

            if (friendUsername && users[friendUsername]) {
                const friendDiv = document.createElement('div');
                friendDiv.textContent = `${friendUsername} (Click to Join Party)`;
                friendDiv.classList.add('button');
                friendDiv.addEventListener('click', () => {
                    alert(`You joined ${friendUsername}'s party!`);
                });
                partyDiv.appendChild(friendDiv);
                alert(`${friendUsername} added as a friend!`);
            } else {
                alert('User not found!');
            }
        });
    </script>
</body>
</html>
