<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Roblox-Style Boss Battle</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; width: 100%; height: 100%; }
  </style>
</head>
<body>
  <!-- Load Babylon.js from CDN -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script>
    // Get the canvas element
    const canvas = document.createElement('canvas');
    document.body.appendChild(canvas);

    // Generate the Babylon.js engine
    const engine = new BABYLON.Engine(canvas, true);

    // Create the scene
    const createScene = function () {
      const scene = new BABYLON.Scene(engine);

      // Add a light
      const light = new BABYLON.HemisphericLight(
        "light",
        new BABYLON.Vector3(0, 1, 0),
        scene
      );
      light.intensity = 0.7;

      // Create the ground (cave floor)
      const ground = BABYLON.MeshBuilder.CreateGround(
        "ground",
        { width: 50, height: 50 },
        scene
      );
      ground.material = new BABYLON.StandardMaterial("groundMat", scene);
      ground.material.diffuseColor = new BABYLON.Color3(0.4, 0.3, 0.2);

      // Create the player (a sphere)
      const player = BABYLON.MeshBuilder.CreateSphere(
        "player",
        { diameter: 1 },
        scene
      );
      player.position.y = 1;
      player.material = new BABYLON.StandardMaterial("playerMat", scene);
      player.material.diffuseColor = new BABYLON.Color3(0, 1, 0);

      // Add a first-person camera
      const camera = new BABYLON.FreeCamera(
        "camera",
        new BABYLON.Vector3(0, 2, -10),
        scene
      );
      camera.attachControl(canvas, true);
      camera.setTarget(player.position);

      // Load a realistic boss model (replace with your own model if needed)
      BABYLON.SceneLoader.ImportMesh(
        "",
        "https://assets.babylonjs.com/meshes/",
        "alien.glb",
        scene,
        function (meshes) {
          const boss = meshes[0];
          boss.position = new BABYLON.Vector3(0, 1, -20);
          boss.scaling = new BABYLON.Vector3(0.5, 0.5, 0.5);

          // Boss animations (if available in the model)
          if (boss.animations && boss.animations.length > 0) {
            const anim = new BABYLON.Animation(
              "bossAnim",
              "position.z",
              30,
              BABYLON.Animation.ANIMATIONTYPE_FLOAT,
              BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE
            );
            const keys = [
              { frame: 0, value: -20 },
              { frame: 100, value: 0 },
            ];
            anim.setKeys(keys);
            boss.animations.push(anim);
            scene.beginAnimation(boss, 0, 100, true);
          }

          // Boss abilities
          const shootProjectile = function () {
            const projectile = BABYLON.MeshBuilder.CreateSphere(
              "projectile",
              { diameter: 0.4 },
              scene
            );
            projectile.material = new BABYLON.StandardMaterial("projectileMat", scene);
            projectile.material.diffuseColor = new BABYLON.Color3(1, 0.8, 0);
            projectile.position.copyFrom(boss.position);

            const direction = player.position.subtract(boss.position).normalize();
            projectiles.push({ mesh: projectile, direction });
          };

          // Start boss abilities
          setInterval(shootProjectile, 2000);
        }
      );

      // Boss projectiles
      const projectiles = [];

      // Game loop
      scene.onBeforeRenderObservable.add(() => {
        // Update projectiles
        projectiles.forEach((proj, index) => {
          proj.mesh.position.addInPlace(proj.direction.scale(0.5));

          // Check for collisions with player
          if (proj.mesh.position.subtract(player.position).length() < 1) {
            alert("Game Over!");
            resetGame();
          }

          // Remove projectiles that go too far
          if (proj.mesh.position.subtract(boss.position).length() > 50) {
            proj.mesh.dispose();
            projectiles.splice(index, 1);
          }
        });
      });

      // Reset game
      const resetGame = function () {
        boss.position.z = -20;
        projectiles.forEach((proj) => proj.mesh.dispose());
        projectiles.length = 0;
      };

      return scene;
    };

    // Create the scene
    const scene = createScene();

    // Render loop
    engine.runRenderLoop(() => {
      scene.render();
    });

    // Handle window resize
    window.addEventListener("resize", () => {
      engine.resize();
    });
  </script>
</body>
</html>
